# Как начать работать с профилем ARL

{% include [briefly-about-arl](../../_includes/smartwebsecurity/briefly-about-arl.md) %}

Создайте первый [профиль ARL](../concepts/arl.md) и подключите его к имеющемуся [профилю безопасности](../concepts/profiles.md) {{ sws-full-name }}.

Если у вас еще не настроен профиль безопасности, создайте его и подключите к [виртуальному хосту](../../application-load-balancer/concepts/http-router.md#virtual-host) L7-балансировщика {{ alb-full-name }}. Подробнее см. [{#T}](../quickstart.md).

Чтобы начать работу с ARL:
1. [Создайте профиль ARL](#profile-create).
1. [Настройте правила](#configure-rules).
1. [Подключите профиль ARL к профилю безопасности](#profile-connect).

## Подготовьте облако к работе {#before-you-begin}

{% include [before-you-begin](../../_tutorials/_tutorials_includes/before-you-begin.md) %}

## Создайте профиль ARL {#profile-create}

{% list tabs group=instructions %}

- Консоль управления {#console}

  1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором вы хотите создать профиль ARL.
  1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_smartwebsecurity }}**.
  1. Перейдите на вкладку ![image](../../_assets/smartwebsecurity/arl.svg) **Профили ARL** и нажмите кнопку **Создать профиль ARL**.
  1. Опишите сценарий использования функциональности ARL в своих проектах и нажмите кнопку **Отправить заявку**.

      После одобрения заявки вы сможете перейти к созданию профиля ARL.
  1. Введите имя профиля, например `test-arl-profile-1`.
  1. При необходимости добавьте описание профиля и метки.
  1. Нажмите кнопку **Создать**.

{% endlist %}

## Настройте правила {#configure-rules}

{% list tabs group=instructions %}

- Консоль управления {#console}

  1. На открывшейся обзорной странице профиля ARL нажмите кнопку **Добавить правило**.
  1. Введите имя правила, например `arl-rule-1`.
  1. В поле **Приоритет** задайте приоритет выполнения правила в рамках профиля ARL, например `1000`.
  1. (Опционально) Чтобы протестировать правило ARL, включите режим **Только логирование (Dry run)**. В этом режиме запросы блокироваться не будут.
  1. В блоке **Условия на трафик** выберите **Весь трафик** или **При условии**.
  1. Чтобы задать [условия на трафик](../concepts/conditions.md), в списке **Условия** выберите один или несколько пунктов:
     *  `IP` — IP-адрес, диапазон адресов или регион IP-адресов;
     *  `HTTP header` — строка в заголовке HTTP;
     *  `HTTP body` — строка в теле HTTP-пакета;
     *  `Request path` — путь запроса;
     *  `Host` — домен, на который пришел запрос.
     *  `HTTP method` — метод запроса;
     *  `Cookie` — строка в заголовке cookie.
  
  1. В блоке **Подсчет запросов** выберите, как считать запросы для применения лимита:
     * **Без группировки** — подсчет каждого запроса в отдельности.
     * **По характеристикам** — подсчет количества групп запросов, объединенных одной или несколькими характеристиками.
        1. Выберите характеристику для группировки:
            *  `Request path` — путь запроса;
            *  `HTTP method` — метод запроса;
            *  `IP-адрес` — IP-адрес, с которого пришел запрос;
            *  `Регион` — регион, которому принадлежат IP-адреса запросов.
            *  `Host` — домен, на который пришел запрос.
            *  `HTTP cookie` — строка в заголовке cookie;
            *  `HTTP header` — строка в заголовке HTTP;
            *  `Query params` — строка в параметрах запроса.
        1. (Опционально) Включите опцию **Учитывать регистр**, чтобы характеристики с одинаковыми значениями, но в разном регистре попадали в разные группы.

  1. Укажите лимит запросов и выберите промежуток времени, например `1000` запросов за `1` минуту.

  1. Нажмите копку **Сохранить правило**.

{% endlist %}

## Подключите профиль ARL к профилю безопасности {#profile-connect}

{% list tabs group=instructions %}

- Консоль управления {#console}

  1. Перейдите на вкладку ![image](../../_assets/console-icons/shield-check.svg) **{{ ui-key.yacloud.smart-web-security.title_profiles }}**.
  1. В списке выберите профиль безопасности, к которому вы хотите подключить профиль ARL, например `test-sp1`.
  1. Нажмите кнопку **Редактировать**.
  1. В списке **Профиль ARL** выберите `test-arl-profile-1`, созданный ранее.
  1. Нажмите кнопку **Сохранить**.

{% endlist %}

### См. также {#see-also}

* [{#T}](../quickstart.md)
* [{#T}](../concepts/arl.md)
