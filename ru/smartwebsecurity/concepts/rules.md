# Правила

Правила позволяют группировать [условия](conditions.md) отбора HTTP-запросов с [действиями](#rule-action), которые будут выполнятся с этими запросами, а также ранжировать приоритет выполнения правил между собой.

Приоритет правила выставляется с помощью числового параметра от `1` до `1000000`.

{% include [preconfigured-rules-priority](../../_includes/smartwebsecurity/preconfigured-rules-priority.md) %}

Также вы можете фиксировать информацию о трафике, который соответствует заданным условиям, но не применять к нему никаких действий.

В сервисе предусмотрены следующие типы правил:
* [Базовые](#base-rules).
* [Smart Protection](#smart-protection-rules).
* [Web Application Firewall](#waf-rules).
* [Advanced Rate Limiter](#arl-rules).

Подробнее см. [Управление правилами](../operations/#rules).

## Базовые правила {#base-rules}

_Базовое правило_ — правило, которое по заданным условиям разрешает, запрещает или направляет трафик в [{{ captcha-full-name }}](../../smartcaptcha/). Применяется для простой фильтрации трафика по определенным параметрам.

В каждом [профиле безопасности](profiles.md) предусмотрено _базовое правило по умолчанию_ с самым низким приоритетом (`1000000`), с помощью которого разрешается или запрещается весь трафик.

## Правила Smart Protection {#smart-protection-rules}

_Smart Protection_ — правило, которое отправляет трафик по заданным условиям на автоматический анализ с помощью алгоритмов машинного обучения и поведенческого анализа. В зависимости от выбранного [действия](#rule-action) подозрительные запросы отправляются в {{ captcha-name }} для дополнительной верификации или блокируются.

## Правила Web Application Firewall {#waf-rules}

Правила Web Application Firewall задействуют [профиль WAF](waf.md) для анализа трафика на соответствие [наборам базовых правил WAF](waf.md#rules-set). В зависимости от выбранного [действия](#rule-action) подозрительные запросы отправляются в [{{ captcha-name }}](../../smartcaptcha/) для дополнительной верификации или блокируются.

Для проверки запросов, соответствующих правилам Smart Protection и Web Application Firewall, вы можете использовать следующие варианты капчи {{ captcha-name }}:

{% include [captcha-integration](../../_includes/smartwebsecurity/captcha-integration.md) %}

## Правила Advanced Rate Limiter {#arl-rules}

Правило [Advanced Rate Limiter](arl.md) вычисляет количество запросов, пришедших за определенный промежуток времени. Запросы считаются после того, как они были разрешены правилами Smart Protection и Web Application Firewall. Поэтому для правил ARL действует свой приоритет, который не зависит от приоритета других правил.

Правила ARL позволяют задать лимиты на весь трафик или на его сегменты.

В отличие от правил Smart Protection и WAF, правила ARL задаются в профиле ARL.

## Действие правил {#rule-action}

Действия для базовых правил:
* _Запретить_ трафик, параметры которого соответствуют условиям.
* _Разрешить_ трафик, параметры которого соответствуют условиям.

Действия для правил Smart Protection и Web Application Firewall:
* _Полная защита_ — трафик проверяется на основе ML-моделей и поведенческого анализа. Подозрительные запросы отправляются в {{ captcha-name }}.
* _Защита API_ — трафик проверяется на основе ML-моделей и поведенческого анализа. Подозрительные запросы блокируются.

Действие для правил Advanced Rate Limiter: _Блокировать запросы свыше лимита_ — когда количество запросов превысит заданный лимит за определенное время, остальные запросы будут блокироваться. Клиент, отправивший запрос, получит ошибку `429`.

Запросы которые были разрешены всеми правилами и пропущены к защищаемому ресурсу, называются _легитимными_.