---
title: "Условия в {{ sws-full-name }}"
description: "Вы можете задать ряд условий для правил безопасности. Подробности в этой статье."
---

# Условия

Вы можете задать следующие условия для [правил](rules.md):

#|
|| **Тип** | **Виды сопоставления** | **Значения** | **Пример** | **Логический оператор** ||
|| `{{ ui-key.yacloud.component.condition-column.condition_name-ip-range }}` |
* Совпадает или принадлежит диапазону
* Не совпадает и не принадлежит диапазону
* IP принадлежит региону
* IP не принадлежит региону
|
* IP-адрес
* [CIDR](https://ru.wikipedia.org/wiki/Бесклассовая_адресация)
* Диапазон адресов
* Двухбуквенный код страны по [ISO 3166-1 alpha-2](https://ru.wikipedia.org/wiki/ISO_3166-1_alpha-2)
|
* `1.2.33.44`
* `2001:0db8:85a3:0000:0000:8a2e:0370:7334`
* `10::1234:1abc:1/64`
* `1.2.0.0-1.2.1.1`
* `ru`
* `kz`
| _или_ ||
|| `{{ ui-key.yacloud.component.condition-column.condition_name-header }}` |
* Совпадает с
* Не совпадает с
* Начинается с
* Не начинается с
* Соответствует регулярному выражению
* Не соответствует регулярному выражению
|
Формат `ключ: значение`, где ключ — HTTP-заголовок,
значение — конкретное значение заголовка, префикс 
значения или [регулярное выражение](https://ru.wikipedia.org/wiki/Регулярные_выражения) библиотеки
[PIRE](https://github.com/yandex/pire)
|
* `User-Agent: curl/7.55.1`
| _и_ ||
|| `{{ ui-key.yacloud.component.condition-column.condition_name-requestUri }}` |
* Совпадает с
* Не совпадает с
* Начинается с
* Не начинается с
* Соответствует регулярному выражению
* Не соответствует регулярному выражению
| 
Путь запроса, начало пути запроса или регулярное
выражение библиотеки PIRE
|
* `/`
| _Не применяется_ ||
|| `Query Match` |
* Совпадает с
* Не совпадает с
* Начинается с
* Не начинается с
* Соответствует регулярному выражению
* Не соответствует регулярному выражению
|
Формат `ключ: значение`, где ключ — параметр 
запроса, значение — конкретное значение параметра,
префикс значения или регулярное выражение библиотеки
PIRE
|  
* `a: 1`
* `A: 2`
| _и_ ||
|| `{{ ui-key.yacloud.component.condition-column.condition_name-authority }}` |
* Совпадает с
* Не совпадает с
* Начинается с
* Не начинается с
* Соответствует регулярному выражению
* Не соответствует регулярному выражению
|
Значения заголовка `Host` для HTTP/1.1 или 
псевдозаголовка `authority` для HTTP/2, по которому
выбирается виртуальный хост, префикс значения или 
регулярное выражение библиотеки PIRE
|
* `example.com`
| _или_ ||
|| `{{ ui-key.yacloud.component.condition-column.condition_name-httpMethod }}` |
* Совпадает с
* Не совпадает с
* Начинается с
* Не начинается с
* Соответствует регулярному выражению
* Не соответствует регулярному выражению
|
[Метод HTTP-запроса](https://ru.wikipedia.org/wiki/HTTP#Методы) в верхнем регистре,
допускается произвольное значение, префикс значения
или регулярное выражение библиотеки PIRE
|
* `GET`
* `POST`
* `DELETE`
| _или_ ||

|| `{{ ui-key.yacloud.component.condition-column.condition_name-cookie }}` |
* Совпадает с
* Не совпадает с
* Начинается с
* Не начинается с
* Соответствует регулярному выражению
* Не соответствует регулярному выражению
|
Формат `ключ: значение`, где ключ — заголовок Cookie,
значение — конкретное значение Cookie, префикс 
значения или регулярное выражение библиотеки PIRE
|
* `csrftoken=u32t4o3tb`
| _и_ ||

|| `{{ ui-key.yacloud.component.condition-column.condition_name-body }}` |
* Совпадает с
* Не совпадает с
* Начинается с
* Не начинается с
* Соответствует регулярному выражению
* Не соответствует регулярному выражению
|
Строка в теле HTTP-пакета или 
регулярное выражение библиотеки PIRE
|
* `<br><input type='submit'>`
| _или_ ||
|#

## Формат регулярных выражений {#regular-expressions}

Регулярные выражения можно использовать в условиях `{{ ui-key.yacloud.component.condition-column.condition_name-header }}`, `{{ ui-key.yacloud.component.condition-column.condition_name-requestUri }}`, `Query Match`, `{{ ui-key.yacloud.component.condition-column.condition_name-authority }}`, `{{ ui-key.yacloud.component.condition-column.condition_name-httpMethod }}`, `{{ ui-key.yacloud.component.condition-column.condition_name-cookie }}`, `{{ ui-key.yacloud.component.condition-column.condition_name-body }}`. Так как в этих условиях есть типы сопоставления «Соответствует регулярному выражению» и «Не соответствует регулярному выражению».

### Группы операторов для регулярных выражений {#regular-expressions-operators}

* Квантификаторы. Определяют количество допустимых повторений элемента.

  * `*` — ноль или более вхождений любых символов, `a*` — ноль или более вхождений символа `a`,`a*b` — любое вхождение символа `a` перед символом `b`.

    Пример: `a*` — пустая строка, `a`, `aa`, `aaa` и так далее.

  * `а+` — одно или более вхождений символа `a`.

    Пример: `a+` — `a`, `aa`, `aaa` и так далее.

  * `a?` — ноль или одно вхождение символа `a`.
    
    Пример: `https?://` — соответствует `http://` и `https://`

  * `{n}` — n вхождений. Пример: `a{3}` — `aaa`.

  * `{n,m}` — от n до m вхождений. Пример: `a{3,5}` — `aaa`, `aaaa`, `aaaaa`.

  * `{n,}` — не менее n вхождений. Пример: `a{3,}` — `aaa`, `aaaa`, `aaaaa` и так далее.

* Символы и операции.
  
    * `.` — любой одиночный символ (кроме новой строки).
  
      Пример: `a.b` соответствует `aab`, `acb`, но не `ab`.

    * `[abc]` — один из символов внутри квадратных скобок.
      
      Пример: `[abc]` соответствует `a`, `b`, `c`.

    * `[^abc]` — любой символ, кроме указанных в квадратных скобках.
      
      Пример: `[^abc]` соответствует любому символу, кроме `a`, `b`, `c`.

    * `[a-z]` — любой символ в диапазоне `a` до `z`.
  
      Пример: `[a-z]` соответствует любой строчной букве от `a` до `z`.
    
    * `a|b` — альтернатива, либо `a`, либо `b`.
    
      Пример: `example|domain` — либо `example`, либо `domain`.

    * `\\w` — любая буква.
    * `\\W` — не буква (цифра, подчеркивание, знаки препинания, пробел и так далее).
    * `\\d` — цифра и `\\D` — не цифра.
    * `\\s` — пробел и `\\S` — не пробел.

{% note info %}

Чтобы использовать символ не как оператор регулярного выражения или специальный символ, экранируйте его с помощью `\`. Например, надо экранировать символы `. + * [ ] ( ) { } ^ $ ?`.

{% endnote %}

### Регистр в регулярных выражениях {#regular-expressions-case}

* Учитывать регистр. Введите регулярное выражение в нужном регистре.
  
  Пример: `exaMple` соответствует строке `exaMple`.

* Не учитывать регистр. В начало выражения добавьте символы `(?i)`.
  
  Пример: `(?i)example` соответствует строкам `example`, `EXaMple`, `EXAMPLE` и так далее.

### Примеры регулярных выражений

* `^User-Agent:\s*$` — блокировать запросы, у которых значение заголовка `User-Agent` пустое или состоит только из пробелов.
    
    В этом выражении `^` — начало строки, `\s*` — ноль или более пробелов, `$` — конец строки.

* `\\[\'\"\.\;]` — блокировать запросы, содержащие `\` перед подозрительным символом (бэкслеш-инъекции).

    В этом выражении `\\` — бэкслеш, `[\'\"\.\;]` — любой символ из скобок.

* `a{100,}` — блокировать запросы, содержащие необычно длинные последовательности одинаковых символов, что может быть признаком DDoS-атаки.
    
    В этом выражении `a{100,}` — 100 или более символов `a` подряд.

* `--.*` — блокировать запросы, содержащие комментарии в SQL-запросах, что может быть признаком SQL-инъекции.

    В этом выражении `--` — начало SQL-комментария, `.*` — ноль или более любых символов.