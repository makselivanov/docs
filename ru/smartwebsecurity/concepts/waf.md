# Профили WAF

{% include [realized-waf-glossary](../../_includes/smartwebsecurity/realized-waf-glossary.md) %}

WAF анализирует входящие HTTP-запросы к веб-приложению по предварительно настроенным правилам. На основе результатов анализа к HTTP-запросам применяются определенные [действия](rules.md#rule-action).

Вы можете управлять WAF с помощью _профиля WAF_, который подключается к [профилю безопасности](profiles.md) в виде отдельного [правила](rules.md).

Подробнее о подключении к профилю безопасности см. на странице [{#T}](../quickstart/quickstart-waf.md).

В профиле WAF доступны следующие настройки:
* [Набор базовых правил](#rules-set).
* [Правила-исключения](#exclusion-rules).
* [Параметры анализа запроса](#request-analysis-parameters).

## Набор базовых правил {#rules-set}

В профиле WAF доступен набор базовых правил [OWASP Core Rule Set](https://coreruleset.org/). Набор разработан открытым проектом обеспечения безопасности веб-приложений OWASP для защиты от эксплуатации уязвимостей, входящих в рейтинг [OWASP TOP‑10](https://owasp.org/www-project-top-ten/). OWASP Core Rule Set состоит из правил, которые предназначены для обнаружения вредоносных действий, включая загрузку вредоносных файлов, потенциальные атаки SQL injection, попытки отказа в обслуживании, попытки инъекции кода и многое другое. Подробности см. в репозитории [OWASP Core Rule Set на GitHub](https://github.com/coreruleset/coreruleset).

_Позднее будут доступны другие наборы базовых правил._

В настройках набора вы можете выбрать конкретные правила для проверки запросов. Для каждого правила установлены значение [аномальности](#anomaly) и [уровень паранойи](#paranoia).

### Аномальность {#anomaly}

Каждому правилу из набора присвоено числовое значение _аномальности_ — признака потенциальной атаки. Чем выше значение, тем более вероятно, что запрос, соответствующий правилу, является атакой. 

Вы можете установить _порог аномальности_ для всего набора правил — суммарную аномальность сработавших правил, при которой запрос будет заблокирован. Возможный диапазон значений для порога — от `2` до `10 000`.

Рекомендуется начинать с порога аномальности `25` и постепенно снижать его до `5`. Чтобы снизить порог аномальности, отработайте ложные срабатывания WAF на легитимные запросы. Для этого подберите правила из базового набора и настройте [правила-исключения](#exclusion-rules). Также для тестирования разных порогов аномальности используйте в профиле безопасности режим **Только логирование (dry-run)**.

Любое правило из набора можно сделать _блокирующим_. Запрос, соответствующий таком правилу, будет заблокирован независимо от установленного порога аномальности. Если в профиле безопасности включен режим **Только логирование (dry-run)**, запросы не будут заблокированы, даже если они соответствуют блокирующим правилам.

### Уровень паранойи {#paranoia}

_Уровень паранойи_ классифицирует правила по степени агрессивности. Чем выше уровень паранойи, тем лучше уровень защиты, но и больше вероятность ложных срабатываний WAF. 

В настройках набора базовых правил вы можете задать общий уровень паранойи, тем самым быстро задействовать список правил с соответствующим уровнем и ниже.

## Правила-исключения {#exclusion-rules}

_Правила-исключения_ предназначены для предотвращения ложных срабатываний WAF на легитимные запросы.

Вы можете настроить пропуск проверок по определенным правилам из набора или по всем правилам сразу.

Для каждого правила-исключения можно задать [условия применения](conditions.md). Если используются несколько условий разных типов, то все они должны быть выполнены, чтобы правило-исключение сработало. Если условия не указаны, правило-исключение будет применено ко всему трафику.

## Параметры анализа запроса {#request-analysis-parameters}

При настройке профиля WAF можно включить инспекцию тела запроса и указать параметры:

* Максимальный размер тела запроса — от 8 КБ (_позднее размер можно будет настроить_).
  
  Определение максимального размера тела запроса влияет на производительность и безопасность веб-приложения. Ограничение размера помогает предотвратить избыточное потребление ресурсов. А также смягчить последствия DoS/DDoS-атак, когда злоумышленники отправляют большие запросы с целью исчерпания ресурсов сервера.
  
* Действия при превышении максимального размера тела запроса:
  * Не анализировать (пропускать). Может использоваться в случаях, когда легитимное приложение часто отправляет большие запросы.
  * Блокировать — более универсальный и безопасный подход. Любые запросы, превышающие установленный лимит, будут блокированы, что уменьшает риск атак.

## См. также {#see-also}

* [{#T}](../quickstart/quickstart-waf.md)