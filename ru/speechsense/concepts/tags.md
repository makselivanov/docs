# Теги в диалогах

_Теги_ создаются и настраиваются на уровне проекта. В каждом проекте может быть разный набор тегов.

{{ speechsense-name }} самостоятельно определяет, встречались ли определенные ключевые фразы в диалоге, и добавляет к нему тег. Например, теги показывают, что оператор поблагодарил клиента за ожидание или что клиент обращается в службу поддержки повторно.

Ключевые фразы в тегах можно задать списком или переиспользовать из [словарей](dictionaries.md). Словари содержат заранее подготовленный набор ключевых фраз, который можно применять для нескольких тегов и поддерживать в одном месте.

Чтобы точнее настроить поиск ключевых фраз:

* Включите настройку **{{ ui-key.yc-ui-talkanalytics.tags.exact-match-key-value }}**. В таком случае родственные фразы не будут учитываться при поиске ключевых фраз.
* Задайте дистанцию между словами. Эта настройка определяет максимальный разрыв, который допустим между словами в ключевой фразе.

  > Например, тегу присвоена ключевая фраза «плохое обслуживание». Поиск этой фразы будет осуществляться по-разному в зависимости от значения поля **{{ ui-key.yc-ui-talkanalytics.tags.words-between-key-value }}**:
  >
  > | Пример фразы в разговоре | Дистанция: `0` | Дистанция: `1` | Дистанция: `2` |
  > | ----------- | ----------- | ----------- | ----------- |
  > | «плохое обслуживание» | найдется | найдется | найдется |
  > | «плохое же обслуживание» | не найдется | найдется | найдется |
  > | «плохое у вас обслуживание» | не найдется | не найдется | найдется |

В тексте диалога можно увидеть перечень присвоенных тегов для каналов оператора и клиента. Если нажать на название тега, его цветом подсветятся те слова, к которым этот тег был отнесен.

Подробнее о создании, изменении и удалении тегов см. в [инструкциях](../operations/index.md#tag).

## Где отображаются теги {#display}

* На вкладке **{{ ui-key.yc-ui-talkanalytics.dialogs.classifiers }}** в проекте.
* В отчетах:
   * В [фильтрах диалогов](dialogs.md#filters), которые доступны на вкладке **{{ ui-key.yc-ui-talkanalytics.projects.dialogs }}**.
   * В списке [параметров оценки](reports/evaluation-form.md#parameters).
* На странице диалога, на который назначен тег.

## Как назначаются теги {#attach}

Чтобы диалогу назначались теги, они должны быть активированы. Активация тега происходит автоматически при его создании. После активации тега сервис {{ speechsense-name }} ищет ключевые фразы в диалогах проекта и назначает тег.

Для корректной работы тега [присвойте ему канал](../operations/project/tag/change.md#tag-channel). В зависимости от канала {{ speechsense-name }} ищет ключевые слова в различных частях диалога:

* **{{ ui-key.yc-ui-talkanalytics.tags.channel.operator-and-client }}** — во всем диалоге;
* **{{ ui-key.yc-ui-talkanalytics.tags.channel.operator }}** — только в речи или сообщениях оператора;
* **{{ ui-key.yc-ui-talkanalytics.tags.channel.client }}** — только в речи или сообщениях клиента.

> Например, если тегу присвоен канал **{{ ui-key.yc-ui-talkanalytics.tags.channel.client }}**, а ключевое слово тега встречается только в речи или сообщениях оператора, тег не назначается на диалог.

Канал настраивается на уровне [проекта](resources-hierarchy.md#project). Это позволяет гибко управлять назначением тегов в различных проектах.

## Ограничение области поиска тегов {#tag-limitations}

С помощью _ограничений_ в {{ speechsense-name }} вы можете сузить область поиска ключевых слов из тегов. При заданном ограничении тег будет срабатывать, только если {{ speechsense-name }} нашел ключевое слово в указанной части диалога.

> Например, задано ограничение со следующими настройками:
> * Вид ограничения — **{{ ui-key.yc-ui-talkanalytics.tags.binding-events.dialog-start-key-value }}**;
> * **{{ ui-key.yc-ui-talkanalytics.tags.search-area-key-value }}** — **{{ ui-key.yc-ui-talkanalytics.tags.search-area.after-key-value }}**;
> * **{{ ui-key.yc-ui-talkanalytics.tags.restrict-search-area-key-value }}** — до трех фраз.
>
> {{ speechsense-name }} будет искать ключевые слова только в первых трех фразах от начала диалога.

Каждое ограничение в {{ speechsense-name }} привязывается к определенному событию, которое служит началом области поиска. Доступны следующие события:

* начало диалога;
* длинная пауза (продолжительность паузы задается вручную);
* оператор перебил клиента;
* клиент перебил оператора;
* конец диалога;
* (для зависимого тега) срабатывание основного тега.

По умолчанию установлен максимальный размер области поиска — 1000 фраз. Чтобы уточнить область поиска, задайте направление поиска от события (вперед, назад, в обе стороны) и количество фраз в области поиска.

Вы можете добавить несколько ограничений для одного тега. Ограничения суммируются по правилам логического И.

## Зависимые теги {#dependent-tags}

Для любого тега {{ speechsense-name }} можно [создать](../operations/project/tag/create.md#create-dependent-tag) _зависимый тег_.  Зависимым называется тег, который срабатывает только при срабатывании _основного_ тега. Основным называется тег, для которого был создан зависимый тег.

Зависимость тегов реализована при помощи [ограничения](#tag-limitations) **{{ ui-key.yc-ui-talkanalytics.tags.binding-events.classifier }}**, которое добавляется в зависимый тег автоматически. Удалить это ограничение нельзя.

Глубина вложенности зависимых тегов не ограничена.

При удалении основного тега удалятся все зависимые от него теги.

## Фразы-исключения {#exclusion-phrases}

Чтобы повысить точность тега, добавьте к нему _фразы-исключения_. Если в диалоге есть фразы-исключения, тег не будет на них срабатывать.

Вы можете добавить фразы-исключения вручную или загрузить словарь с фразами.

> Например, создадим тег `Пожар` и добавим в него ключевую фразу `загорелась`.
> Тег сработает на фразе `Лампочка загорелась красным`, однако такая фраза не обозначает пожар. Это ложное срабатывание. Чтобы избавиться от него, добавим фразу-исключение `лампочка загорелась`.
> Теперь тег не сработает на фразе `Лампочка загорелась красным`, но сработает на фразе `Загорелся утюг`.

Чтобы точнее настроить фразу-исключение:

* Включите настройку **{{ ui-key.yc-ui-talkanalytics.tags.exact-match-key-value }}**. В таком случае родственные фразы не будут учитываться при поиске фраз-исключений.
* Задайте дистанцию между словами. Эта настройка определяет максимальный разрыв, который допустим между словами во фразе-исключении.
