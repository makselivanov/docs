# Правило

_Правило_ — компонент маршрутизации, состоящий из фильтра и 1-5 [приемников](#target). К [шине](bus.md) могут быть привязаны несколько правил. Каждое событие, поступившее в шину, проходит через все правила шины. Прежде чем срабатывает правило, проверяется, соответствует ли событие условиям, заданным в [фильтре](#filter). Если соответствует, правило срабатывает, и событие отправляется всем приемникам, указанным в правиле.

## Фильтр {#filter}

_Фильтр_ — выражение в [формате jq](https://jqlang.github.io/jq/), которое определяет, надо ли отправлять событие указанным в правиле приемникам. Если фильтр пустой, правило считается сработавшим и события отправляются всем приемникам. Если не получается распарсить событие или тело события не удовлетворяет условиям, заданным в фильтре, правило не срабатывает. События в формате, отличном от JSON, можно обработать, но для них недоступна проверка по фильтру.

## Приемник {#target}

_Приемник_ — это получатель события, например функция {{ sf-name }}, контейнер {{ serverless-containers-name }}, очередь {{ message-queue-name }}, поток данных {{ yds-name }} и т.п.

{{ er-name }} поддерживает гарантию доставки `At least once`. Если временно невозможно доставить или получить подтверждение о доставке, {{ er-name }} будет повторно пытаться отправить событие до истечения времени жизни события. Количество повторных попыток и максимальное время жизни события задаются в настройках приемника. Событие, которое не удалось обработать, перемещается в указанную клиентом очередь Dead Letter Queue.

В целях оптимизации {{ er-name }} позволяет задать настройки группирования событий для некоторых типов приемников. В приемнике может быть задан jq-шаблон, в соответствии с которым события преобразовываются перед отправкой в приемник.
