# Чтение данных из {{ objstorage-name }} с помощью соединений с {{ yq-name }}

При работе с {{ objstorage-full-name }} с помощью соединений удобно выполнять прототипирование, первоначальную настройку подключений к данным.

Пример запроса для чтения данных:

```sql
SELECT
    *
FROM
    object_storage.`*.tsv`
WITH
(
    format=tsv_with_names,
    SCHEMA
    (
        `timestamp` Uint32,
        action String 
    )
);
```

## Настройка соединения {#create_connection}

Чтобы создать соединение с {{ objstorage-short-name }}:

{% include [!](../_includes/create-object-storage-connection.md) %}

## Модель данных {#data_model}

В {{ objstorage-short-name }} данные хранятся в файлах в бинарном виде. Для чтения данных используйте SQL-выражение:

```sql
SELECT
    <выражение>
FROM
    <соединение>.<путь>
WITH(
    FORMAT = "<формат_данных>",
    COMPRESSION = "<формат_сжатия>",
    SCHEMA = (<описание схемы>))
WHERE
    <фильтр>;
```

Где:

* `<соединение>` — название [соединения](#create_connection) с хранилищем.
* `<путь>` — путь к файлу или файлам внутри бакета. Поддерживаются wildcards `*`.
* `<формат_данных>` — [формат данных](formats.md#formats) в файлах.
* `<формат_сжатия>` — [формат сжатия](formats.md#compression_formats) файлов.
* `<описание схемы>` — [описание схемы хранимых данных](#schema) в файлах.

### Описание схемы данных {#schema}

Описание схемы данных состоит из набора полей:

- Названия поля.
- Типа поля.
- Признака обязательности данных.

Например, схема данных ниже описывает поле схемы с названием `Year` типа `Int32` и требованием наличия этого поля в данных:

```text
Year Int32 NOT NULL
```

Если поле данных помечено как обязательное, `NOT NULL`, но это поле отсутствует в обрабатываемом файле, то работа с таким файлом будет завершена с ошибкой. Если поле помечено как необязательное, `NULL`, то при отсутствии поля в обрабатываемом файле не будет возникать ошибки, но поле при этом примет значение `NULL`. Ключевое слово `NULL` в необязательных полях опционально.

### Автоматический вывод схемы данных {#inferring}

Автоматический вывод схемы доступен для всех [форматов данных](formats.md#formats), кроме `raw` и `json_as_string`. Он удобен в том случае, когда схема содержит большое количество полей. Для того, чтобы не вводить эти поля вручную, используйте параметр `WITH_INFER`:

```sql
SELECT
    <выражение>
FROM
    <соединение>.<путь>
WITH(
    FORMAT = "<формат_данных>",
    COMPRESSION = "<формат_сжатия>",
    WITH_INFER="true")
WHERE
    <фильтр>;
```

Где:

* `<соединение>` — название [соединения](#create_connection) с хранилищем.
* `<путь>` — путь к файлу или файлам внутри бакета. Поддерживаются wildcards `*`.
* `<формат_данных>` — [формат данных](formats.md#formats) в файлах.
* `<формат_сжатия>` — [формат сжатия](formats.md#compression_formats) файлов.


В результате выполнения такого запроса будут автоматически выведены названия и типы полей.

### Форматы путей к данным {#path_format}

В {{ yq-full-name }} поддерживаются следующие пути к данным:

{% include [!](../_includes/object-storage-path-format.md) %}

## Пример чтения данных c помощью соединений {#read_example}

Пример запроса для чтения данных из {{ objstorage-short-name }}:

```sql
SELECT
    *
FROM
    connection.`folder/filename.csv`
WITH(
    format='csv_with_names',
    SCHEMA 
    (
        Year int,
        Manufacturer String,
        Model String,
        Price Double
    )
);
```

Где:

* `connection` — название соединения с {{ objstorage-short-name }}.
* `folder/filename.csv` — путь к файлу в бакете {{ objstorage-short-name }}.
* `SCHEMA` — описание схемы данных в файле.
