---
title: "Как отправить серию запросов в режиме чата в {{ yagpt-full-name }}"
description: "Следуя данной инструкции, вы научитесь использовать {{ yagpt-full-name }} в режиме чата."
---

# Как реализовать чат с {{ yagpt-name }}

Модели {{ yagpt-full-name }} не хранят контекст предшествующих сообщений, поэтому для реализации диалога с моделью историю сообщений нужно сохранять на стороне клиента и передавать в каждом обращении к модели. [Чат](../../concepts/yandexgpt/index.md), доступный в {{ foundation-models-name }} Playground, представляет собой серию промт-запросов, в которой в контекст каждого нового запроса добавляются ответы модели на предыдущие запросы. Модели {{ yagpt-full-name }} могут работать с контекстом до {{ yagpt-max-tokens }} [токенов](../../concepts/yandexgpt/tokens.md).

Чтобы реализовать в своем приложении чат с моделью и избежать задержек с ответами, отправляйте промт-запросы в [синхронном](../../concepts/index.md#working-mode) режиме с помощью метода [completion](../../text-generation/api-ref/TextGeneration/completion.md).

Чтобы реализовать чат:

1. {% include notitle [ai-before-beginning](../../../_includes/foundation-models/yandexgpt/ai-before-beginning.md) %}

1. Подготовьте файл запроса к модели, например `body.json`:

   ```json
   {
     "modelUri": "gpt://<идентификатор_каталога>/yandexgpt-lite",
     "completionOptions": {
       "stream": false,
       "temperature": 0.6,
       "maxTokens": "2000"
     },
     "messages": [
       {
         "role": "system",
         "text": "Ты умный ассистент"
       },
       {
         "role": "user", 
         "text": "Привет! Какими науками занимался Альберт Эйнштейн?"
       }
     ]
   }
   ```

   Где:

   {% include [api-parameters](../../../_includes/foundation-models/yandexgpt/api-parameters.md) %}

1. Отправьте запрос к модели:

   {% list tabs group=programming_language %}

   - cURL {#curl}

     Выполните команду:

     ```bash
     export FOLDER_ID=<идентификатор_каталога>
     export IAM_TOKEN=<IAM-токен>
     curl \
       --request POST \
       --header "Content-Type: application/json" \
       --header "Authorization: Bearer ${IAM_TOKEN}" \
       --header "x-folder-id: ${FOLDER_ID}" \
       --data "@<путь_до_файла_json>" \
       "https://llm.{{ api-host }}/foundationModels/v1/completion"
     ```

     Где:

     * `FOLDER_ID` — идентификатор каталога, на который у вашего аккаунта есть роль `{{ roles-yagpt-user }}` или выше.
     * `IAM_TOKEN` — IAM-токен вашего аккаунта.

   - Python 3 {#python}

     1. Создайте файл `index.py` и добавьте в него код:

        ```python
        import requests
        import json
        import os

        def gpt(auth_headers):

            url = 'https://llm.api.cloud.yandex.net/foundationModels/v1/completion'

            with open('body.json', 'r', encoding='utf-8') as f:
                data = json.dumps(json.load(f))
            resp = requests.post(url, headers=auth_headers, data=data)

            if resp.status_code != 200:
                raise RuntimeError(
                    'Invalid response received: code: {}, message: {}'.format(
                        {resp.status_code}, {resp.text}
                    )
                )

            return resp.text

        if __name__ == "__main__":
            if os.getenv('IAM_TOKEN') is not None:
                iam_token = os.environ['IAM_TOKEN']
                headers = {
                    'Authorization': f'Bearer {iam_token}',
                }
            elif os.getenv('API_KEY') is not None:
                api_key = os.environ['API_KEY']
                headers = {
                    'Authorization': f'Api-Key {api_key}',
                }
            else:
                print ('Please save either an IAM token or an API key into a corresponding `IAM_TOKEN` or `API_KEY` environment variable.')
                exit()

            print(gpt(headers))
        ```

     1. Сохраните данные для аутентификации в переменную окружения:

        **Для аутентификации с помощью IAM-токена:**

        ```bash
        export IAM_TOKEN=<IAM-токен>
        ```

        **Для аутентификации с помощью API-ключа (только для сервисного аккаунта):**

        ```bash
        export API_KEY=<API-ключ>
        ```

     1. Выполните созданный файл:

        ```bash
        python index.py
        ```

   {% endlist %}

1. В ответ на запрос модель вернет сгенерированный текст:

   {% cut "Результат:" %}
 
   ```json
   {
     "result": {
       "alternatives": [
         {
           "message": {
             "role": "assistant",
             "text": "Альберт Эйнштейн был выдающимся физиком, труды которого в области теоретической физики, теоретической механики и философии науки стали фундаментальными. Он посвятил свою карьеру изучению основ Вселенной, включая теорию относительности, специальную и общую теорию относительности. Кроме того, Альберт Эйнштейн изучал:\n\n* термодинамику,\n* статистическую механику,\n* электромагнетизм,\n* квантовую теорию,\n* специальную теорию относительности и др.\n\nЕго работы по общей теории относительности получили широкое признание и оказали глубокое влияние на развитие современной физики."
           },
           "status": "ALTERNATIVE_STATUS_FINAL"
         }
       ],
       "usage": {
         "inputTextTokens": "28",
         "completionTokens": "110",
         "totalTokens": "138"
       },
       "modelVersion": "18.01.2024"
     }
   }
   ```
 
   {% endcut %}
 
   Сохраните значение записи `message` для использования в последующем запросе.

1. В конец массива `messages` в файл запроса добавьте значение записи `message`, полученное в результате выполнения предыдущего запроса к модели, а также новый вопрос пользователя:

   ```json
   {
     "modelUri": "gpt://<идентификатор_каталога>/yandexgpt-lite",
     "completionOptions": {
       "stream": false,
       "temperature": 0.6,
       "maxTokens": "2000"
     },
     "messages": [
       {
         "role": "system",
         "text": "Ты умный ассистент"
       },
       {
         "role": "user", 
         "text": "Привет! Какими науками занимался Альберт Эйнштейн?"
       },
       {
         "role": "assistant", 
         "text": "Альберт Эйнштейн был выдающимся физиком, труды которого в области теоретической физики, теоретической механики и философии науки стали фундаментальными. Он посвятил свою карьеру изучению основ Вселенной, включая теорию относительности, специальную и общую теорию относительности. Кроме того, Альберт Эйнштейн изучал:\n\n* термодинамику,\n* статистическую механику,\n* электромагнетизм,\n* квантовую теорию,\n* специальную теорию относительности и др.\n\nЕго работы по общей теории относительности получили широкое признание и оказали глубокое влияние на развитие современной физики."
       },
       {
         "role": "user", 
         "text": "Какие важные открытия он совершил?"
       }
     ]
   }
   ```

1. Отправьте новый запрос к модели, повторив третий шаг инструкции. В ответ на запрос модель снова вернет сгенерированный текст:

   {% cut "Результат:" %}

   ```json
   {
     "result": {
       "alternatives": [
         {
           "message": {
             "role": "assistant",
             "text": "Вот некоторые открытия, которые обычно связывают с именем Альберта Эйнштейна:\n1. **Специальная теория относительности (СТО)** — теория, описывающая движение, законы механики и пространственно-временные отношения при произвольных скоростях, меньших скорости света в вакууме.\n1. **Общая теория относительности (ОТО)** — геометрическая теория тяготения, основанная на предсказании взаимосвязи между координатами пространства-времени, материи и энергии.\n1. **Квантовая теория фотоэффекта** — объяснение фотоэффекта, явления выбивания электронов из вещества под действием электромагнитного излучения.\n1. **Броуновское движение** — явление беспорядочного, случайного движения микроскопических частиц, взвешенных в жидкости или газе, происходящее из-за теплового движения молекул окружающей среды.\n1. **Эквивалентность гравитационной и инерционной массы** — идея о том, что гравитационная и инертная масса являются разными аспектами одной и той же величины.\n1. **Космологические решения уравнений ОТО** — вклад в теорию строения и динамики Вселенной.\n1. **Ядерная модель атома** — описание структуры атома на основе протонов, нейтронов и электронов.\nЭто лишь некоторые из открытий Альберта Эйнштейна. Его вклад в науку и философию огромен, и его исследования продолжают оказывать влияние на наши представления о природе и Вселенной."
           },
           "status": "ALTERNATIVE_STATUS_FINAL"
         }
       ],
       "usage": {
         "inputTextTokens": "154",
         "completionTokens": "278",
         "totalTokens": "432"
       },
       "modelVersion": "18.01.2024"
     }
   }
   ```

   {% endcut %}

   Снова сохраните значение записи `message` для использования в последующем запросе.

1. Продолжайте дополнять контекст запроса полученными ответами и вопросами пользователя:

   ```json
   {
     "modelUri": "gpt://<идентификатор_каталога>/yandexgpt-lite",
     "completionOptions": {
       "stream": false,
       "temperature": 0.6,
       "maxTokens": "2000"
     },
     "messages": [
       {
         "role": "system",
         "text": "Ты умный ассистент"
       },
       {
         "role": "user", 
         "text": "Привет! Какими науками занимался Альберт Эйнштейн?"
       },
       {
         "role": "assistant", 
         "text": "Альберт Эйнштейн был выдающимся физиком, труды которого в области теоретической физики, теоретической механики и философии науки стали фундаментальными. Он посвятил свою карьеру изучению основ Вселенной, включая теорию относительности, специальную и общую теорию относительности. Кроме того, Альберт Эйнштейн изучал:\n\n* термодинамику,\n* статистическую механику,\n* электромагнетизм,\n* квантовую теорию,\n* специальную теорию относительности и др.\n\nЕго работы по общей теории относительности получили широкое признание и оказали глубокое влияние на развитие современной физики."
       },
       {
         "role": "user", 
         "text": "Какие важные открытия он совершил?"
       },
       {
         "role": "assistant",
         "text": "Вот некоторые открытия, которые обычно связывают с именем Альберта Эйнштейна:\n1. **Специальная теория относительности (СТО)** — теория, описывающая движение, законы механики и пространственно-временные отношения при произвольных скоростях, меньших скорости света в вакууме.\n1. **Общая теория относительности (ОТО)** — геометрическая теория тяготения, основанная на предсказании взаимосвязи между координатами пространства-времени, материи и энергии.\n1. **Квантовая теория фотоэффекта** — объяснение фотоэффекта, явления выбивания электронов из вещества под действием электромагнитного излучения.\n1. **Броуновское движение** — явление беспорядочного, случайного движения микроскопических частиц, взвешенных в жидкости или газе, происходящее из-за теплового движения молекул окружающей среды.\n1. **Эквивалентность гравитационной и инерционной массы** — идея о том, что гравитационная и инертная масса являются разными аспектами одной и той же величины.\n1. **Космологические решения уравнений ОТО** — вклад в теорию строения и динамики Вселенной.\n1. **Ядерная модель атома** — описание структуры атома на основе протонов, нейтронов и электронов.\nЭто лишь некоторые из открытий Альберта Эйнштейна. Его вклад в науку и философию огромен, и его исследования продолжают оказывать влияние на наши представления о природе и Вселенной."
       },
       {
         "role": "user",
         "text": "Сократи свой ответ"
       }
     ]
   }
   ```

   {% cut "Результат:" %}

   ```json
   {
     "result": {
       "alternatives": [
         {
           "message": {
             "role": "assistant",
             "text": "Альберт Эйнштейн — выдающийся физик, изучавший основы Вселенной, в частности, теорию относительности, термодинамику и электромагнетизм.\n\nИзвестные открытия учёного: специальная и общая теория относительности, квантовая теория фотоэффекта и др."
           },
           "status": "ALTERNATIVE_STATUS_FINAL"
         }
       ],
       "usage": {
         "inputTextTokens": "452",
         "completionTokens": "54",
         "totalTokens": "506"
       },
       "modelVersion": "18.01.2024"
     }
   }
   ```

   {% endcut %}

